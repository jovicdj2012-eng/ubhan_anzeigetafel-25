<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Wiener Linien Live Monitor</title>
<style>
body{margin:0;background:#111;color:white;font-family:Arial,sans-serif}
.container{width:900px;margin:auto;padding:20px}
.topbar{display:flex;justify-content:space-between;margin-bottom:20px}
.weather,.clock{background:#222;padding:14px 28px;border-radius:12px;font-size:24px}
.clock{font-size:26px}
.title{text-align:center;margin-bottom:15px}
.panel{background:#2b2b2b;border-radius:18px;padding:22px}
.header-line{font-size:28px;margin-bottom:15px;font-weight:bold}
.departure{display:flex;justify-content:space-between;align-items:center;padding:14px;border-bottom:1px solid #444}
.line-box{background:#d60000;padding:12px 22px;border-radius:10px;font-weight:bold;font-size:24px}
.direction{font-size:20px;margin-left:10px;color:#ccc}
.time{color:orange;font-size:32px;font-weight:bold}
</style>
</head>
<body>
<div class="container">
<div class="topbar">
<div class="weather" id="weather">--°C Wien</div>
<div class="clock" id="clock">--:--</div>
</div>
<div class="title">
<h1>Wiener Linien</h1>
<h2>U1 Oberlaa</h2>
</div>
<div class="panel">
<div class="header-line">Nächste Ankünfte</div>
<div class="departure"><div class="line-box">U1</div><div class="direction">→ Leopoldau</div><div class="time" id="t1">--</div></div>
<div class="departure"><div class="line-box">U1</div><div class="direction">→ Leopoldau</div><div class="time" id="t2">--</div></div>
<div class="departure"><div class="line-box">U1</div><div class="direction">→ Leopoldau</div><div class="time" id="t3">--</div></div>
<div class="departure"><div class="line-box">U1</div><div class="direction">→ Leopoldau</div><div class="time" id="t4">--</div></div>
</div>
</div>

<script>
// Uhr
function updateClock(){
    const now=new Date();
    document.getElementById("clock").innerText = now.toLocaleTimeString("de-AT",{hour:"2-digit",minute:"2-digit"});
}
updateClock();
setInterval(updateClock,1000);

// Wetter alle 5 Minuten
async function updateWeather(){
    try{
        const res = await fetch("https://api.open-meteo.com/v1/forecast?latitude=48.2&longitude=16.37&current_weather=true");
        const data = await res.json();
        document.getElementById("weather").innerText = Math.round(data.current_weather.temperature) + "°C Wien";
    }catch(e){console.log("Wetter Fehler");}
}
updateWeather();
setInterval(updateWeather,300000);

// Wiener Linien Ankünfte direkt per Cross-Origin
async function updateTimes(){
    try{
        const rbl = "214666497"; // Stop-ID Oberlaa
        const url = "https://api.allorigins.win/raw?url=" + encodeURIComponent("https://www.wienerlinien.at/ogd_realtime/monitor?rbl=" + rbl);
        const res = await fetch(url);
        const data = await res.json();
        const lines = data.data.monitors[0].lines;
        const u1 = lines.find(l=>l.name==="U1");
        const deps = u1.departures.departure;

        for(let i=0;i<4;i++){
            const dep = deps[i];
            if(dep){
                const arrivalTime = dep.departureTime.timePlanned;
                const diff = Math.floor((new Date(arrivalTime)-new Date())/60000);
                const display = diff <= 0 ? "jetzt" : diff+" min";
                document.getElementById("t"+(i+1)).
